# EmailOperation_ExcelShell_Guide
## (EML Extraction Process)
### 1. 배경

- 본 문서는 **특정 요청에 따라 특정 직원의 특정 기간 이메일 본문(EML)을 조사 목적으로 수집** 해야 할 경우, 
주어진 메일 리스트는 엑셀에 정리되어 있고 **내부 시스템을 통해 이메일(EML 파일)를 개별 다운로드** 한다. 
다운로드 하는 파일이 많은 경우 과정에서 누락과 중복 없이 정확하게 다운로드 되었는지 검증하는 과정이 필수이다. 
이 문서의 목적은 **EML 다운로드 시 휴먼에러 최소화**하고 **엑셀 기반 자동화된 검증 프로세스**를 사용하고 **명확한 파일명-날짜 매칭 기준**을 수립하는 것이다.

- 개인정보 및 회사 정보가 포함되지 않은 일반화 버전입니다.


- 다운로드 개수는 요청된 리스트와 반드시 동일해야 하므로 검증 작업을 병행해야 한다. 
**작업 전체는 다음 단계로 이루어진다.** 
- 엑셀에서 이메일 본문 리스트 정리
- 각 이메일 본문을 EML로 파일 다운로드
- 다운로드된 파일을 폴더 단위로 정리
- CMD로 폴더 내 파일 리스트 출력
- 파일명을 엑셀로 불러와 날짜 추출 -> 정렬
- 원본 리스트와 대조하여 누락/중복 검증
- 개수 검증 후 완료
- 엑셀 기반 검증 시트 구성
   

### 2. 작업 단계

#### 2.1 엑셀 리스트 준비
- 아래는 실제 파일이 아닌 예시 형태로만 구성된 검증 시트 구조이다. 민감 정보는 전부 익명화 했으며 형식을 이해하기 위한 샘플 테이블입니다.
| 폴더명          | 발신인                                               | 수발신일자            | 파일 수발신일자       | 일자 비교 | 파일이름                            | 제목                    |
| ------------ | ------------------------------------------------- | ---------------- | -------------- | ----- | ------------------------------- | --------------------- |
| SampleFolder | [sender01@sample.com](mailto:sender01@sample.com) | 2025-08-05 13:24 | 20250805132401 | TRUE  | O20250805132401_SampleTitle.eml | [Fwd] 샘플 제목입니다        |
| SampleFolder | [sender02@sample.com](mailto:sender02@sample.com) | 2025-08-05 07:52 | 20250805075221 | TRUE  | I20250805075221_Sample.eml      | Re: 요청하신 내용 확인 부탁드립니다 |

- 메일 시스템에서 다음 조건으로 필터링하여 리스트를 다운로드한다. 
요청된 직원 ID(email) / 요청된 기간(연-월-일 단위 선택) / 제목 필터 (필요한 경우), 다운로드된 파일은 엑셀에서 본문 작업용 시트로 정리한다

#### 2.2 EML 다운로드
시트별 이름 (요청자 기준 또는 사번 기준)으로 폴더를 생성한다. 각 메일 본문을 하나씩 EML 파일로 다운로드 한다. 폴더 하단의 파일 개수를 확인하여 1차 검증한다.

#### 2.3 CMD 기반 파일 리스트 출력
CMD를 통해 다운로드 파일이 있는 폴더에서 빠르게 파일명을 추출한다 

예시 :
cd C:\Users\userName\Documents\EML_Download_Folder
dir /w > list.txt

생성된 list.txt를 열어 파일명을 복사하고 액셀의 새 시트에 붙여넣는다

#### 2.4 파일명에서 날짜 분리 및 정렬
파일명에는 보통 다음 구조가 포함된다. 
I20250805162433_메일제목.eml
O20250805132401_메일제목.eml

앞의 숫자 구간을 이용해 날짜와 시간으로 분리한다.

액셀 함수 예시:
=LEFT(A2, 15)
=MID(A2, 2, 14)
=DATE(LEFT(F2,4), MID(F2,5,2), MID(F2,7,2)) + TIME(MID(F2,9,2),MID(F2,11,2),MID(F213,2))
날짜 변환 후 내림차순(최신순)으로 정렬한다.

#### 2.5 검증 시트 작성
요청 리스트(원본)와 다운로드된 파일 리스트(정렬된 버전)을 대조한다.
수발신 날짜가 다르면 다운로드 오류 또는 누락으로 간주한다. 
파일명 중복(예 : 파일명(1).eml)이 있을 경우 재다운로드 필요하다.
모든 파일을 검증 후 최종적으로 요청 개수와 다운로드 개수가 일치해야 한다.

#### 3. 엑셀에서 자주 사용되는 함수 모음

- 3.1 이름/ID 분리
 LEFT(B2, FIND("<", B2) - 2)
MID(B2, FIND("<", B2) + 1, FIND("@", B2) - FIND("<", B2) -1 )

- 3.2 분, 초 추출
TEXT(C2, "mm:ss")

- 3.3 태그 뒤 6자리 추출
TRIM(MID(J2, IFERROR(FIND("]",J2)+1, 1), 6))

- 3.4 제먹 태그([] 구간) 분리
IFERROR(LEFT(J2, FIND("]",J2) + 1), "")

- 3.5 날짜 문자열 정제
RIGHT(A2, LEN(A2)-16)
LEFT(A2, 13)

- 3.6 파일명 기반 날짜 변환
DATE(LEFT(F2,4), MID(F2,5,2), MID(F2,7,2)) + TIME(MID(F2,9,2), MID(F2,11,2), MID(F2,13,2))

- 4. Shell / Bash 검증 명령어 예시 (선택적으로 사용)
폴더 내 파일을 빠르게 개수 및 패턴 검증 할때 사용 가능하다

ls - l | grep -oE '[0-9]{8}' | cut -c1-6 | sort | uniq -c
awk -F '_' '{if (substr($1, 6,2) == "07") print $0}'
ls | grep '^202407'

- 5. 주의사항
실제 직원 이름, 이메일 주소, 시스템 구조 등은 외부 유출 금지
GitHub 게시 시 본 문서와 같은 일반화/익명화 버전만 사용
파일명 예시 또한 가상의 샘플로 변환하여 사용
내부 시스템 화면 캡처는 업로드 금지


